Redis, NodeJs Cách khắc phục kho còn 1 nhưng có nhiều USERS mua hàng cùng một lúc

// giả sử số lượng tồn kho hiện tại là 10
const slTonkho = 10
//tn của sp.
const keyName = "iPhone13"
// mỗi lần mua thì lượng tiêu thụ hàng tồn kho là 1
const slMua = 1;
//sl đã bán ra, nếu ch bán được thì set = 0, còn nếu đã bán thì update + 1 mỗi lần user order thành công
: Lưu ý exists của tồn tại và nó check xem keyName có tồn tại không
const getKey = await exists(keyName);
if(!getKey) {
await set(keyName, 0)
}
//lấy số lượng bán ra
const slBanRa = await get(keyName)
//Nếu số lượng bán ra + số lượng mua(slMua) > slTonKho return false
